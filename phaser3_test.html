<!DOCTYPE html>
<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.0.0/dist/phaser.min.js"></script>
</head>

<body>

    <script>
        $(function () {
            var game_screen_canvas = $('div.game-screen')[0];
            console.log(game_screen_canvas);
            var config = {
                type: Phaser.CANVAS,
                parent: game_screen_canvas,
                width: 800,
                height: 600,
                physics: {
                    default: 'arcade',
                    arcade: {
                        gravity: { y: 0 }
                    }
                },
                scene: {
                    preload: preload,
                    create: create
                }
            };

            var game = new Phaser.Game(config);

            function preload() {
                //this.load.setBaseURL('http://labs.phaser.io');
                // this.load.image('sky', 'assets/skies/space3.png');
                // this.load.image('logo', 'assets/sprites/phaser3-logo.png');
                // this.load.image('red', 'assets/particles/red.png');
                // this.load.image('block', 'assets/sprites/50x50-white.png');
                console.log(window.location);
                console.log(window.location.host);
                this.load.setBaseURL('http://localhost:5000/static/');

                this.load.image('sky', 'assets/skies/sky.png');
                this.load.image('logo', 'assets/sprites/aqua_ball.png');
                this.load.image('red', 'assets/particles/red.png');
                this.load.image('block', 'assets/sprites/50x50-white.png');
            }

            function create() {
                this.add.image(400, 300, 'sky');

                var particles = this.add.particles('red');

                var emitter = particles.createEmitter({
                    speed: 100,
                    scale: { start: 1, end: 0 },
                    blendMode: 'ADD'
                });
                
                
                console.log(this.physics);
                var logo = this.physics.add.image(400, 100, 'logo');

                logo.setMaxVelocity(100, 800);
                logo.setVelocity(100, 200);
                logo.setBounce(0.5, 1.05);
                logo.setCollideWorldBounds(true);
                logo.body.enable = true;
                // logo.body.bounce.y = 1.5;
                emitter.startFollow(logo);

                var blocks = this.physics.add.group(
                    {
                        key: 'block',
                        repeat: 1,
                        setXY: { x: 400, y: 100, stepX: 100, stepY: 500 }
                    }
                );

                var ph = this.physics;
                blocks.children.iterate(function (block) {
                    block.setCollideWorldBounds(true);
                    console.log(block);
                    block.body.enable = true;
                    block.body.bounce.y = 1.5;
                    block.body.immovable = true;
                    ph.add.collider(logo, block);
                });
            }
        });

    </script>
    <h1>Hello phaser!</h1>
    <div class="game-screen">
        </canvas>
</body>

</html>