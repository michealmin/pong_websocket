<!DOCTYPE html>
<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="/static/phaser.js"></script>
    <!-- <script type="module" src="static/js/game_main.js"></script> -->
    <script type="module">
        import {GameMain} from '/static/js/game_main.js';

        var game_main = null;
        function enterRoom(room_no, token, player_name, ) {
            var ori = window.location.origin;
            if (null === game_main) {
                game_main = new GameMain(ori);
            }

            game_main.createGame();

            var id = setInterval(()=>{
                if(game_main.isScenesActive()){
                game_main.initConnection('ws://' + window.location.host + '/room/');
                game_main.enterRoom(room_no, token, player_name, ()=>{

                    $('div.login-scree').hide();
                    $('div.game-screen').show();
                    });
                    clearInterval(id);

                }
            }, 100);
        }



        function login() {
            console.log('Start login...');
            $.ajax({
                url: '/lobby/room',
                type: "POST",
                data: JSON.stringify({
                    type: 'requestEnterRoom'
                }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function(data) {
                    console.log('recv room data : ' + JSON.stringify(data));
                    enterRoom(data.room_no, data.token, $('input#player-name')[0].value);
                }
            });
        }

        $(function () {
            $('button#login').click(login);
        });
    </script>

</head>

<body>

    <div class="login-screen">
        <label for="player-name">이름</label>
        <input type="text" id="player-name" />
        <button id="login">로그인</button>
    </div>

    <div class="game-screen ">
    </div>
</body>

</html>